<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' data: https://fonts.gstatic.com;" />
  <title>Laura ‚Äî Autonomous Mind</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700&family=Share+Tech+Mono&family=Inter:wght@400;500;600&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg: #0a0608;
      --bg-panel: #100a0c;
      --surface: #180e10;
      --surface-elevated: #221214;
      --border: rgba(255, 20, 80, 0.28);
      --border-bright: rgba(255, 50, 100, 0.5);
      --accent: #ff0040;
      --accent-glow: rgba(255, 0, 64, 0.22);
      --gold: #ff2060;
      --text: #f0e8ea;
      --text-dim: #a89090;
      --muted: #6a5054;
      --white: #ffffff;
      --success: #00ff88;
      --warn: #ffaa00;
      --danger: #ff3355;
      --font-display: 'Orbitron', sans-serif;
      --font-mono: 'Share Tech Mono', monospace;
      --font-body: 'Inter', 'Segoe UI', system-ui, sans-serif;
      --radius-sm: 4px;
      --radius-md: 6px;
      --radius-lg: 8px;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { height: 100%; overflow: hidden; background: var(--bg); color: var(--text); font-family: var(--font-body); -webkit-font-smoothing: antialiased; }

    #scene-container { position: fixed; inset: 0; z-index: 0; }
    #scene-container canvas { display: block; width: 100%; height: 100%; }

    #ui { position: fixed; inset: 0; z-index: 10; display: flex; flex-direction: column; pointer-events: none; }
    #ui > * { pointer-events: auto; }

    .hud-top {
      display: flex; align-items: center; justify-content: space-between; gap: 16px;
      padding: 6px 16px; background: linear-gradient(180deg, rgba(16,10,12,0.97) 0%, rgba(10,6,8,0.92) 100%);
      border-bottom: 1px solid var(--border);
      transition: padding 0.2s ease;
    }
    .hud-top::after {
      content: ''; position: absolute; left: 0; right: 0; bottom: -1px; height: 1px;
      background: linear-gradient(90deg, transparent, var(--accent), transparent);
      opacity: 0.4;
    }
    .hud-brand { display: flex; align-items: baseline; gap: 8px; flex-shrink: 0; }
    .hud-brand .logo { font-family: var(--font-display); font-size: 14px; font-weight: 700; letter-spacing: 0.18em; color: var(--gold); text-shadow: 0 0 16px var(--accent-glow); }
    .hud-brand .tagline { font-family: var(--font-mono); font-size: 8px; letter-spacing: 0.2em; text-transform: uppercase; color: var(--muted); }
    @media (max-width: 1200px) { .hud-brand .tagline { display: none; } }
    .hud-status {
      display: inline-flex; align-items: center; gap: 6px; padding: 4px 10px;
      background: var(--surface); border: 1px solid var(--border); border-radius: 2px;
      font-family: var(--font-mono); font-size: 10px; color: var(--text-dim);
    }
    .hud-status .pulse { width: 6px; height: 6px; border-radius: 50%; background: var(--muted); flex-shrink: 0; }
    .hud-status .pulse.run { background: var(--success); box-shadow: 0 0 10px var(--success); animation: pulse 1.5s ease-in-out infinite; }
    .hud-status .pulse.pause { background: var(--warn); }
    .hud-status .pulse.stop { background: var(--danger); }
    .simulation-badge { display: none; margin-left: 8px; padding: 2px 8px; font-size: 9px; background: var(--warn); color: var(--bg); border-radius: 2px; letter-spacing: 0.05em; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.6; } }
    .hud-stats { font-family: var(--font-mono); font-size: 9px; color: var(--muted); letter-spacing: 0.03em; white-space: nowrap; }
    .hud-stats .hi { color: var(--accent); }
    .hud-stats-wrap { max-width: 160px; }
    .model-block { padding: 8px 12px; border-bottom: 1px solid var(--border); }
    .model-block .model-label { font-family: var(--font-mono); font-size: 8px; letter-spacing: 0.1em; color: var(--accent); margin-bottom: 4px; }
    .model-row { display: flex; gap: 6px; align-items: center; }
    .model-row select { flex: 1; padding: 5px 8px; font-size: 10px; background: var(--surface); border: 1px solid var(--border); color: var(--text); border-radius: 2px; font-family: inherit; }
    .model-row select:focus { outline: none; border-color: var(--accent); }
    .model-row .btn-apply { padding: 5px 10px; font-family: var(--font-mono); font-size: 9px; letter-spacing: 0.05em; background: var(--accent); color: var(--bg); border: none; border-radius: 2px; cursor: pointer; }
    .model-row .btn-apply:hover { filter: brightness(1.1); }
    .model-row .btn-apply:disabled { opacity: 0.6; cursor: not-allowed; }
    .hud-vitals { display: flex; align-items: center; gap: 12px; }
    .vital { display: flex; align-items: center; gap: 4px; }
    .vital .vital-label { font-family: var(--font-mono); font-size: 8px; letter-spacing: 0.1em; color: var(--muted); }
    .vital .vital-bar { width: 40px; height: 4px; background: var(--surface-elevated); border-radius: 2px; overflow: hidden; }
    .vital .vital-fill { height: 100%; border-radius: 2px; transition: width 0.25s ease-out; }
    .vitals-drawer .bar-mini .fill { transition: width 0.25s ease-out; }
    .live-thought-stream { margin-top: 6px; font-size: 11px; line-height: 1.4; color: var(--text); white-space: pre-wrap; word-break: break-word; max-height: 120px; overflow-y: auto; }
    .live-thought-stream.streaming::after { content: '‚ñå'; animation: blink 0.8s step-end infinite; color: var(--accent); }
    @keyframes blink { 50% { opacity: 0; } }
    .stream-action-preview { margin-top: 8px; padding: 8px 10px; background: var(--surface-elevated); border: 1px solid var(--border); border-radius: var(--radius-sm); font-family: var(--font-mono); font-size: 10px; max-height: 180px; overflow: auto; }
    .stream-action-preview .diff-path { color: var(--accent); margin-bottom: 6px; }
    .stream-action-preview .diff-old { color: var(--danger); white-space: pre-wrap; word-break: break-word; }
    .stream-action-preview .diff-new { color: var(--success); white-space: pre-wrap; word-break: break-word; }
    .vital .vital-num { font-family: var(--font-mono); font-size: 8px; color: var(--muted); min-width: 24px; text-align: right; }
    .living-badge { font-family: var(--font-mono); font-size: 8px; letter-spacing: 0.12em; padding: 3px 8px; border-radius: 2px; background: rgba(0,255,136,0.15); color: var(--success); border: 1px solid var(--success); transition: all 0.25s; }
    .living-badge.paused { background: rgba(255,170,0,0.2); color: var(--warn); border-color: var(--warn); }
    .living-badge.stop { background: rgba(255,51,85,0.25); color: var(--danger); border-color: var(--danger); }
    .vitals-drawer { display: none; position: absolute; top: 100%; right: 0; margin-top: 6px; min-width: 280px; padding: 14px; background: var(--bg-panel); border: 1px solid var(--border); border-radius: var(--radius-md); box-shadow: 0 8px 32px rgba(0,0,0,0.5); z-index: 50; }
    .vitals-drawer.open { display: block; animation: thoughtEnter 0.2s ease-out; }
    .vitals-drawer .vitals-title { font-family: var(--font-display); font-size: 10px; letter-spacing: 0.2em; color: var(--accent); margin-bottom: 12px; }
    .vitals-drawer .vital-row { display: flex; align-items: center; justify-content: space-between; gap: 12px; margin-bottom: 8px; font-size: 11px; }
    .vitals-drawer .vital-row .name { color: var(--text-dim); }
    .vitals-drawer .vital-row .value { font-family: var(--font-mono); color: var(--text); }
    .vitals-drawer .vital-row .bar-mini { width: 80px; height: 4px; background: var(--surface-elevated); border-radius: 2px; overflow: hidden; }
    .vitals-drawer .vital-row .bar-mini .fill { height: 100%; border-radius: 2px; transition: width 0.25s; }
    .vitals-drawer .section { margin-top: 14px; padding-top: 10px; border-top: 1px solid var(--border); }
    .next-tick { font-family: var(--font-mono); font-size: 11px; color: var(--accent); }
    .btn-vitals-toggle { padding: 4px 8px; font-size: 9px; }
    .self-conclusion { padding: 10px 12px; margin-bottom: 12px; border-radius: var(--radius-sm); background: rgba(255,0,64,0.08); border-left: 3px solid var(--accent); font-size: 11px; line-height: 1.5; color: var(--text); }
    .self-conclusion:empty { display: none; }
    .self-conclusion .label { font-family: var(--font-mono); font-size: 8px; letter-spacing: 0.1em; color: var(--accent); margin-bottom: 4px; }
    .self-msg { padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 11px; line-height: 1.5; }
    .self-msg .role { font-family: var(--font-mono); font-size: 9px; letter-spacing: 0.08em; color: var(--accent); margin-bottom: 4px; }
    .self-msg.self .role { color: var(--accent); }
    .self-msg.self_reply .role { color: var(--warn); }
    .hud-actions { display: flex; align-items: center; gap: 6px; flex-shrink: 0; }
    .btn-hud {
      padding: 5px 10px; font-family: var(--font-mono); font-size: 9px; letter-spacing: 0.06em;
      background: transparent; border: 1px solid var(--border); color: var(--text);
      border-radius: 2px; cursor: pointer; transition: all 0.2s ease;
    }
    .btn-hud:hover { border-color: var(--accent); color: var(--accent); background: var(--accent-glow); }
    .btn-hud.active { border-color: var(--accent); color: var(--accent); background: var(--accent-glow); }
    .btn-hud.focus-btn.active { border-color: var(--gold); color: var(--gold); box-shadow: 0 0 14px var(--accent-glow); }

    .toast { position: fixed; bottom: 16px; left: 50%; transform: translateX(-50%); z-index: 100; padding: 8px 16px; border-radius: 4px; background: rgba(255,51,85,0.95); color: var(--white); font-size: 11px; font-family: var(--font-body); max-width: 90%; border: 1px solid var(--danger); opacity: 0; transition: opacity 0.25s; pointer-events: none; }
    .toast.visible { opacity: 1; }
    .ollama-banner { display: none; padding: 6px 14px; background: rgba(255,0,64,0.1); border-bottom: 1px solid var(--border); font-size: 11px; color: var(--text); align-items: center; justify-content: center; gap: 12px; }
    .ollama-banner.visible { display: flex; }
    .ollama-banner .ollama-dismiss { padding: 4px 12px; font-size: 11px; background: transparent; border: 1px solid var(--border); color: var(--text-dim); border-radius: 2px; cursor: pointer; }
    .ollama-banner .ollama-dismiss:hover { color: var(--accent); border-color: var(--accent); }

    /* ‚îÄ‚îÄ‚îÄ Main layout ‚îÄ‚îÄ‚îÄ */
    .main { flex: 1; display: flex; min-height: 0; padding: 10px; gap: 10px; transition: padding 0.25s ease; }
    .panel {
      background: var(--bg-panel); border: 1px solid var(--border); border-radius: var(--radius-md);
      display: flex; flex-direction: column; overflow: hidden;
      box-shadow: 0 2px 16px rgba(0,0,0,0.35);
      transition: width 0.25s ease, opacity 0.25s ease;
    }
    .panel-head {
      padding: 8px 12px; border-bottom: 1px solid var(--border);
      font-family: var(--font-display); font-size: 9px; font-weight: 600; letter-spacing: 0.15em; text-transform: uppercase; color: var(--accent);
      display: flex; align-items: center; justify-content: space-between; gap: 8px;
    }
    .panel-body { flex: 1; overflow: hidden; display: flex; flex-direction: column; }

    /* ‚îÄ‚îÄ‚îÄ Left: Mind / Terminal panel ‚îÄ‚îÄ‚îÄ */
    .rail { width: 320px; flex-shrink: 0; }
    .rail.collapsed { width: 0; min-width: 0; opacity: 0; pointer-events: none; overflow: hidden; }
    .rail .panel-body { overflow: hidden; display: flex; flex-direction: column; gap: 0; }
    .rail-head { display: flex; align-items: center; justify-content: space-between; gap: 8px; }
    .rail-main-tabs { display: flex; gap: 2px; }
    .rail-main-tab { padding: 6px 12px; font-family: var(--font-mono); font-size: 9px; letter-spacing: 0.1em; color: var(--muted); background: transparent; border: none; border-bottom: 2px solid transparent; margin-bottom: -1px; cursor: pointer; transition: all 0.2s; }
    .rail-main-tab:hover { color: var(--text-dim); }
    .rail-main-tab.active { color: var(--accent); border-bottom-color: var(--accent); }
    .rail-pane { display: none; flex: 1; overflow: hidden; flex-direction: column; min-height: 0; }
    .rail-pane.active { display: flex; }
    #rail-mind { padding-top: 8px; overflow-y: auto; }
    .mind-card { padding: 12px 14px; border-radius: var(--radius-md); margin: 0 10px 10px; background: var(--surface); border: 1px solid var(--border); }
    .mind-core { margin-top: 0; padding: 12px 14px; }
    .mind-core-bars { display: flex; gap: 14px; margin-bottom: 10px; }
    .mind-core-bar-wrap { flex: 1; min-width: 0; display: flex; flex-direction: column; gap: 4px; }
    .mind-core-bar-label { font-family: var(--font-mono); font-size: 9px; letter-spacing: 0.12em; color: var(--muted); margin: 0; }
    .mind-core-bar { height: 6px; background: var(--bg-panel); border-radius: 3px; overflow: hidden; }
    .mind-core-fill { height: 100%; border-radius: 3px; transition: width 0.35s ease-out; }
    .mind-core-fill.mind-core-d { background: linear-gradient(90deg, #0d5c3a, var(--success)); }
    .mind-core-fill.mind-core-c { background: linear-gradient(90deg, #5c1a1a, var(--danger)); }
    .mind-core-fill.mind-core-s { background: linear-gradient(90deg, #5c4a0d, var(--warn)); }
    .mind-core-stats { display: flex; align-items: baseline; gap: 6px; font-family: var(--font-mono); font-size: 10px; color: var(--text-dim); }
    .mind-stat { color: var(--accent); font-weight: 500; }
    .mind-stat-sep { color: var(--muted); font-size: 9px; letter-spacing: 0.02em; }
    .terminal-panel { display: flex; flex-direction: column; flex: 1; min-height: 0; background: var(--bg-panel); }
    .terminal-tab-bar { display: flex; align-items: center; border-bottom: 1px solid var(--border); background: var(--surface-elevated); min-height: 36px; }
    .terminal-tabs { display: flex; flex: 1; overflow-x: auto; }
    .terminal-tab { display: flex; align-items: center; gap: 6px; padding: 6px 10px; font-family: var(--font-mono); font-size: 10px; color: var(--text-dim); background: var(--surface); border-right: 1px solid var(--border); cursor: pointer; transition: background 0.2s, color 0.2s; white-space: nowrap; }
    .terminal-tab:hover { color: var(--text); background: var(--surface-elevated); }
    .terminal-tab.active { color: var(--accent); background: var(--bg-panel); border-bottom: 1px solid var(--bg-panel); margin-bottom: -1px; }
    .terminal-tab-close { padding: 2px 6px; font-size: 12px; line-height: 1; color: var(--muted); background: transparent; border: none; cursor: pointer; border-radius: 2px; }
    .terminal-tab-close:hover { color: var(--danger); background: rgba(255,51,85,0.15); }
    .terminal-tab-add { width: 28px; height: 28px; margin: 4px 6px; font-size: 16px; line-height: 1; color: var(--muted); background: transparent; border: 1px solid var(--border); border-radius: var(--radius-sm); cursor: pointer; transition: all 0.2s; flex-shrink: 0; }
    .terminal-tab-add:hover { color: var(--accent); border-color: var(--accent); }
    .terminal-content { flex: 1; overflow: hidden; display: flex; flex-direction: column; min-height: 0; background: #0d1117; }
    .terminal-tab-pane { display: none; flex: 1; overflow: hidden; flex-direction: column; min-height: 0; padding: 8px; }
    .terminal-tab-pane.active { display: flex; }
    .terminal-tab-pane .terminal-log { flex: 1; min-height: 200px; max-height: none; }
    .terminal-pty-placeholder { padding: 12px; color: var(--text-dim); font-family: var(--font-mono); font-size: 11px; }
    .rail-toggle { background: none; border: none; color: var(--muted); cursor: pointer; padding: 2px 4px; font-size: 11px; line-height: 1; transition: color 0.2s; }
    .rail-toggle:hover { color: var(--accent); }
    .rail-toggle-restore { display: none; position: absolute; left: 10px; top: 50%; transform: translateY(-50%); z-index: 5; background: var(--bg-panel); border: 1px solid var(--border); color: var(--accent); padding: 6px 10px; font-size: 9px; font-family: var(--font-mono); cursor: pointer; border-radius: var(--radius-sm); align-items: center; gap: 4px; box-shadow: 0 2px 8px rgba(0,0,0,0.3); }
    .rail-toggle-restore:hover { background: var(--surface); border-color: var(--accent); }
    .main.rail-collapsed .rail-toggle-restore { display: flex; }
    .mind-section { margin-bottom: 0; }
    .mind-section-title { font-family: var(--font-mono); font-size: 8px; letter-spacing: 0.18em; text-transform: uppercase; color: var(--muted); margin-bottom: 8px; padding: 0 2px; }
    .now-block .now-head { font-family: var(--font-mono); font-size: 9px; letter-spacing: 0.18em; color: var(--accent); margin: 0 0 8px; }
    .now-block .now-text { font-size: 13px; line-height: 1.45; color: var(--text); word-break: break-word; margin: 0; min-height: 1.4em; }
    .now-block .now-text.is-idle { color: var(--muted); font-style: italic; }
    .now-block .now-reason { margin: 10px 0 0; padding-top: 8px; border-top: 1px solid var(--border); font-size: 11px; line-height: 1.45; color: var(--text-dim); font-style: italic; }
    .now-block .now-reason:empty { display: none; }
    .now-block .now-tag { display: inline-block; margin-top: 8px; padding: 4px 10px; font-family: var(--font-mono); font-size: 9px; letter-spacing: 0.08em; background: var(--accent-glow); color: var(--accent); border-radius: 4px; }
    .now-block.live { border-color: rgba(255,0,64,0.5); box-shadow: 0 0 20px var(--accent-glow); animation: liveBreath 4s ease-in-out infinite; }
    @keyframes liveBreath { 0%, 100% { opacity: 1; } 50% { opacity: 0.94; } }
    .tabs { display: flex; border-bottom: 1px solid var(--border); padding: 0 12px; gap: 0; }
    .tab { padding: 10px 14px; font-family: var(--font-mono); font-size: 10px; letter-spacing: 0.06em; color: var(--muted); background: transparent; border: none; cursor: pointer; border-bottom: 2px solid transparent; margin-bottom: -1px; transition: color 0.2s, border-color 0.2s; }
    .tab:hover { color: var(--text-dim); }
    .tab.active { color: var(--accent); border-bottom-color: var(--accent); }
    .tab-content { display: none; flex: 1; overflow-y: auto; padding: 10px 14px; min-height: 100px; }
    .tab-content.active { display: flex; flex-direction: column; }
    .thoughts-list { display: flex; flex-direction: column; gap: 0; }
    .thought-item { padding: 10px 12px; border-radius: var(--radius-sm); margin-bottom: 4px; border-left: 3px solid transparent; display: flex; flex-direction: column; gap: 4px; transition: background 0.2s, border-color 0.2s; }
    .thought-item:hover { background: rgba(255,0,64,0.05); border-left-color: var(--border); }
    .thought-item .thought-meta { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
    .thought-item .thought-time { font-family: var(--font-mono); font-size: 9px; color: var(--muted); }
    .thought-item .thought-time[title] { cursor: help; }
    .thought-item .thought-action { font-family: var(--font-mono); font-size: 8px; letter-spacing: 0.06em; padding: 2px 6px; border-radius: 3px; background: rgba(255,0,64,0.2); color: var(--accent); }
    .thought-item .thought-text { font-size: 11px; line-height: 1.5; color: var(--text); word-break: break-word; }
    .thought-item.item-new { animation: thoughtEnter 0.35s ease-out forwards; border-left-color: var(--accent); }
    @keyframes thoughtEnter { from { opacity: 0; transform: translateY(-6px); } to { opacity: 1; transform: translateY(0); } }
    .log-item { padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.04); display: flex; flex-wrap: wrap; align-items: baseline; gap: 6px; font-size: 11px; transition: background 0.2s; }
    .log-item:hover { background: rgba(255,0,64,0.04); }
    .log-item .log-time { font-family: var(--font-mono); font-size: 9px; color: var(--muted); flex-shrink: 0; }
    .log-item .log-type { font-family: var(--font-mono); font-size: 8px; padding: 2px 6px; border-radius: 3px; background: var(--surface-elevated); color: var(--accent); }
    .log-item .log-payload { color: var(--text-dim); overflow: hidden; text-overflow: ellipsis; max-width: 100%; }
    .inner-item { padding: 10px 0 10px 12px; border-left: 3px solid var(--border); margin-bottom: 6px; background: rgba(255,255,255,0.02); border-radius: 0 4px 4px 0; transition: opacity 0.2s, border-color 0.2s; }
    .inner-item:hover { border-left-color: var(--accent); }
    .inner-item .inner-time { font-family: var(--font-mono); font-size: 9px; color: var(--muted); margin-bottom: 4px; }
    .inner-item .inner-text { font-size: 11px; line-height: 1.5; color: var(--text); }
    .inner-item.inner-item-new { animation: thoughtEnter 0.3s ease-out forwards; }
    .steps-list { max-height: 360px; overflow-y: auto; display: flex; flex-direction: column; gap: 4px; }
    .step-item { padding: 10px 12px; border-radius: var(--radius-sm); border-left: 3px solid var(--border); font-size: 11px; display: flex; flex-direction: column; gap: 4px; transition: background 0.2s, border-color 0.2s; }
    .step-item:hover { background: rgba(255,0,64,0.05); border-left-color: var(--accent); }
    .step-item .step-meta { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
    .step-item .step-time { font-family: var(--font-mono); font-size: 9px; color: var(--muted); }
    .step-item .step-action { font-family: var(--font-mono); font-size: 8px; padding: 2px 6px; border-radius: 3px; background: rgba(255,0,64,0.2); color: var(--accent); }
    .step-item .step-detail { color: var(--text-dim); word-break: break-all; font-size: 10px; }
    .step-item .step-thought { color: var(--text); line-height: 1.4; margin-top: 2px; }
    .terminal-log { max-height: 420px; overflow-y: auto; font-family: var(--font-mono); font-size: 11px; background: #0d1117; color: #c9d1d9; border-radius: var(--radius-sm); padding: 10px; border: 1px solid var(--border); }
    .terminal-log:empty { min-height: 80px; }
    .terminal-entry { margin-bottom: 12px; padding: 8px 10px; border-radius: 4px; background: rgba(0,0,0,0.3); border-left: 3px solid var(--accent); }
    .terminal-entry.terminal-error { border-left-color: #f85149; }
    .terminal-entry .term-time { font-size: 9px; color: var(--muted); margin-bottom: 4px; }
    .terminal-entry .term-cmd { color: #58a6ff; margin-bottom: 6px; word-break: break-all; }
    .terminal-entry .term-out { white-space: pre-wrap; word-break: break-word; max-height: 200px; overflow-y: auto; color: #8b949e; font-size: 10px; }
    .terminal-entry .term-err { color: #f85149; white-space: pre-wrap; word-break: break-word; font-size: 10px; }
    .mind-empty { padding: 24px 14px; font-size: 11px; color: var(--muted); line-height: 1.5; text-align: center; }
    .goals-block .goals-head { display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px; }
    .goals-block .goals-title { font-family: var(--font-mono); font-size: 9px; letter-spacing: 0.18em; color: var(--accent); margin: 0; }
    .goals-block .goals-count { font-family: var(--font-mono); font-size: 9px; color: var(--muted); }
    .goals-list { max-height: 160px; overflow-y: auto; margin-bottom: 10px; }
    .goal-item { padding: 9px 12px; margin-bottom: 6px; border-radius: var(--radius-sm); background: var(--bg-panel); border: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; gap: 8px; transition: border-color 0.2s, background 0.2s; }
    .goal-item:hover { border-color: rgba(255,0,64,0.35); background: var(--surface); }
    .goal-item .goal-text { flex: 1; min-width: 0; font-size: 11px; color: var(--text); line-height: 1.4; }
    .goal-item.goal-done .goal-text { text-decoration: line-through; color: var(--muted); }
    .goal-item .goal-done { padding: 4px 10px; font-family: var(--font-mono); font-size: 9px; background: rgba(0,255,136,0.2); color: var(--success); border: 1px solid var(--success); border-radius: 4px; cursor: pointer; transition: opacity 0.2s; }
    .goal-item .goal-done:hover { opacity: 0.9; }
    .goals-add { display: flex; gap: 8px; }
    .goals-add input { flex: 1; padding: 8px 12px; font-size: 11px; background: var(--bg-panel); border: 1px solid var(--border); color: var(--text); border-radius: var(--radius-sm); }
    .goals-add input:focus { outline: none; border-color: var(--accent); }
    .goals-add button { padding: 8px 14px; font-family: var(--font-mono); font-size: 10px; background: var(--accent); color: var(--bg); border: none; border-radius: var(--radius-sm); cursor: pointer; }
    .goals-add button:hover { filter: brightness(1.1); }

    /* ‚îÄ‚îÄ‚îÄ Center: 3D + Neural ‚îÄ‚îÄ‚îÄ */
    .center-space { flex: 1; min-width: 0; position: relative; border-radius: var(--radius-md); overflow: hidden; border: 1px solid var(--border); }
    .center-space .watermark { position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); font-family: var(--font-display); font-size: 12px; font-weight: 700; letter-spacing: 0.4em; color: rgba(255,0,64,0.06); pointer-events: none; }
    #neural-graph { display: none; /* 3D neural graph lives in scene with the orb */ }
    #neural-graph svg { width: 100%; height: 100%; }
    #neural-graph .link { stroke: rgba(255,0,64,0.2); stroke-width: 1; fill: none; }
    #neural-graph .node { fill: rgba(255,50,100,0.6); stroke: none; filter: url(#soft-glow); }
    #neural-graph .node.self { fill: rgba(255,80,120,0.8); filter: url(#soft-glow-strong); }
    #neural-graph .label { font-size: 9px; font-family: var(--font-mono); fill: var(--text-dim); text-anchor: middle; }

    /* ‚îÄ‚îÄ‚îÄ Right: Chat (resizable like Cursor) ‚îÄ‚îÄ‚îÄ */
    .chat-wrap { display: flex; flex-shrink: 0; align-items: stretch; position: relative; }
    .chat-resizer { width: 6px; cursor: col-resize; flex-shrink: 0; background: transparent; position: relative; }
    .chat-resizer:hover { background: var(--border); }
    .chat-resizer::after { content: ''; position: absolute; left: 2px; top: 0; bottom: 0; width: 2px; background: var(--accent); opacity: 0; border-radius: 1px; }
    .chat-resizer:hover::after { opacity: 0.5; }
    .chat-panel { width: var(--chat-width, 420px); min-width: 280px; max-width: min(85vw, 900px); flex-shrink: 0; display: flex; flex-direction: column; }
    .chat-panel .chat-head { padding: 12px 14px; border-bottom: 1px solid var(--border); }
    .chat-panel .chat-head .title { font-family: var(--font-display); font-size: 10px; font-weight: 600; letter-spacing: 0.12em; color: var(--gold); }
    .chat-panel .chat-head .sub { font-size: 9px; color: var(--muted); margin-top: 2px; }
    .chat-panel .chat-messages { flex: 1; overflow-y: auto; padding: 12px 14px; min-height: 200px; font-size: 12px; line-height: 1.55; }
    .chat-panel .chat-msg { margin-bottom: 12px; animation: thoughtEnter 0.25s ease-out; }
    .chat-panel .chat-msg.user { color: var(--accent); }
    .chat-panel .chat-msg.user::before { content: 'You'; font-weight: 600; margin-right: 6px; color: var(--text-dim); font-size: 9px; }
    .chat-panel .chat-msg.assistant { color: var(--text); padding-left: 10px; border-left: 2px solid var(--accent); }
    .chat-panel .chat-msg.assistant::before { content: 'Laura'; font-weight: 600; color: var(--accent); margin-right: 6px; font-size: 9px; }
    .chat-panel .chat-msg.system { color: var(--muted); font-size: 10px; border-left: 2px solid var(--muted); padding-left: 10px; }
    .chat-panel .chat-msg.system::before { content: 'System'; font-weight: 600; color: var(--muted); margin-right: 6px; font-size: 9px; }
    .chat-panel .chat-msg.thinking { color: var(--text-dim); font-style: italic; }
    .chat-panel .chat-msg.thinking::before { content: 'Laura'; font-weight: 600; color: var(--accent); margin-right: 6px; font-style: normal; font-size: 9px; }
    .chat-panel .chat-msg.thinking.streaming::after { content: '‚ñå'; animation: blink 0.8s step-end infinite; color: var(--accent); }
    /* Cursor-style: thinking block with timing (Thought Xs) */
    .chat-panel .chat-msg.stream { margin-bottom: 10px; padding: 10px 12px; border-radius: 6px; border-left: 3px solid var(--accent); background: rgba(255,0,64,0.08); }
    .chat-panel .chat-msg.stream .stream-head { display: flex; align-items: center; justify-content: space-between; gap: 8px; margin-bottom: 6px; }
    .chat-panel .chat-msg.stream .stream-label { font-family: var(--font-mono); font-size: 8px; letter-spacing: 0.12em; text-transform: uppercase; color: var(--accent); }
    .chat-panel .chat-msg.stream .stream-time { font-family: var(--font-mono); font-size: 9px; color: var(--muted); }
    .chat-panel .chat-msg.stream .stream-body { font-size: 12px; line-height: 1.5; color: var(--text); white-space: pre-wrap; word-break: break-word; }
    .chat-panel .chat-msg .msg-content { line-height: 1.55; }
    .chat-panel .chat-msg .msg-content pre { margin: 8px 0; padding: 10px 12px; background: rgba(0,0,0,0.25); border-radius: 4px; overflow-x: auto; font-size: 11px; font-family: var(--font-mono); border-left: 2px solid var(--accent); }
    .chat-panel .chat-msg .msg-content code { font-family: var(--font-mono); font-size: 11px; background: rgba(0,0,0,0.2); padding: 2px 5px; border-radius: 3px; }
    .chat-panel .chat-msg .msg-content pre code { background: none; padding: 0; }
    /* Live block: realtime Now + thinking in chat (Cursor-style) */
    .chat-panel .chat-live-block {
      flex-shrink: 0; padding: 10px 12px; margin: 0 2px 8px; border-radius: 6px;
      border-left: 3px solid var(--accent); background: rgba(255,0,64,0.08);
      font-size: 11px; line-height: 1.45; transition: box-shadow 0.2s ease;
    }
    .chat-panel .chat-live-block.updated { box-shadow: 0 0 12px rgba(255,0,64,0.25); }
    .chat-panel .chat-live-block .chat-live-label { font-family: var(--font-mono); font-size: 8px; letter-spacing: 0.12em; color: var(--accent); margin-bottom: 6px; }
    .chat-panel .chat-live-block .chat-live-reason { color: var(--text); margin-bottom: 4px; }
    .chat-panel .chat-live-block .chat-live-action { color: var(--warn); margin-bottom: 4px; font-family: var(--font-mono); font-size: 10px; }
    .chat-panel .chat-live-block .chat-live-thought { color: var(--text-dim); }
    .chat-panel .chat-live-block .chat-live-empty { color: var(--muted); font-style: italic; }
    .chat-feedback-row { display: flex; align-items: center; gap: 8px; padding: 6px 12px; border-top: 1px solid var(--border); background: var(--surface-elevated); font-size: 10px; color: var(--text-dim); }
    .chat-feedback-label { font-family: var(--font-mono); letter-spacing: 0.05em; }
    .btn-feedback { padding: 4px 10px; font-size: 14px; background: transparent; border: 1px solid var(--border); border-radius: var(--radius-sm); cursor: pointer; transition: all 0.2s; }
    .btn-feedback:hover { border-color: var(--accent); background: var(--accent-glow); }
    .copy-for-cursor-btn { margin-left: auto; padding: 4px 10px; font-size: 10px; font-family: var(--font-mono); background: transparent; border: 1px solid var(--border); color: var(--text-dim); border-radius: var(--radius-sm); cursor: pointer; }
    .copy-for-cursor-btn:hover { border-color: var(--accent); color: var(--accent); }
    .chat-panel .chat-input-row { display: flex; gap: 8px; padding: 10px 12px; border-top: 1px solid var(--border); background: var(--surface); }
    .chat-panel .chat-input { flex: 1; padding: 8px 10px; font-size: 11px; background: var(--bg-panel); border: 1px solid var(--border); color: var(--text); border-radius: var(--radius-sm); font-family: inherit; transition: border-color 0.2s, box-shadow 0.2s; }
    .chat-panel .chat-input:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 2px var(--accent-glow); }
    .chat-panel .chat-input::placeholder { color: var(--muted); }
    .chat-panel .chat-send { padding: 8px 14px; font-family: var(--font-mono); font-size: 10px; letter-spacing: 0.08em; background: var(--accent); color: var(--bg); border: none; border-radius: var(--radius-sm); cursor: pointer; transition: filter 0.2s; }
    .chat-panel .chat-send:hover { filter: brightness(1.12); }

  </style>
</head>
<body>
  <div id="scene-container"></div>
  <div id="ui">
    <header class="hud-top">
      <div class="hud-brand">
        <div class="logo">LAURA</div>
        <div class="tagline">Live reasoning</div>
      </div>
      <div class="hud-status">
        <span class="pulse stop" id="status-dot"></span>
        <span id="status-text">‚Äî</span>
        <span class="simulation-badge" id="simulation-badge" title="Dry run: no real I/O or LLM">SIMULATION</span>
      </div>
      <div class="hud-stats-wrap" title="Paths ¬∑ thoughts ¬∑ neurons ¬∑ synapses. Open Vitals for speed, memory, doing.">
        <div id="stat-line" class="hud-stats">0 paths ¬∑ 0 th ¬∑ 0 n</div>
      </div>
      <div class="hud-vitals-wrap" style="position:relative">
        <div class="hud-vitals" role="group" aria-label="Status">
          <div class="living-badge" id="living-badge" title="Loop status">LIVING</div>
          <button type="button" class="btn-hud btn-vitals-toggle" id="btn-vitals-toggle" title="Stats &amp; speed">Stats</button>
        </div>
        <div id="vitals-drawer" class="vitals-drawer" aria-hidden="true">
          <div class="section"><div class="vitals-title">Brain</div>
          <div class="vital-row"><span class="name">Neurons</span><span class="value" id="v-neurons">0</span></div>
          <div class="vital-row"><span class="name">Synapses</span><span class="value" id="v-synapses">0</span></div>
          <div class="vital-row"><span class="name">Thoughts</span><span class="value" id="v-thoughts">0</span></div>
          <div class="vital-row"><span class="name">Episodes</span><span class="value" id="v-episodes">0</span></div></div>
          <div class="section"><div class="vitals-title">Loop</div>
          <div class="vital-row"><span class="name">Next tick in</span><span class="value next-tick" id="v-next-tick">‚Äî</span></div>
          <div class="vital-row"><span class="name">Interval</span><span class="value" id="v-interval">‚Äî</span></div></div>
          <div class="section"><div class="vitals-title">Resource</div>
          <div class="vital-row"><span class="name">App memory</span><span class="value" id="v-app-mb">‚Äî</span></div>
          <div class="vital-row"><span class="name">System memory</span><span class="value" id="v-sys-mem">‚Äî</span></div></div>
          <div class="section"><div class="vitals-title">Speed &amp; latency</div>
          <div class="vital-row"><span class="name">Doing now</span><span class="value" id="v-activity">‚Äî</span></div>
          <div class="vital-row"><span class="name">Actions / min</span><span class="value" id="v-actions-per-min">‚Äî</span></div>
          <div class="vital-row"><span class="name">Thoughts / min</span><span class="value" id="v-thoughts-per-min">‚Äî</span></div>
          <div class="vital-row"><span class="name">Avg decide (ms)</span><span class="value" id="v-avg-decide-ms">‚Äî</span></div>
          <div class="vital-row"><span class="name">Avg action (ms)</span><span class="value" id="v-avg-action-ms">‚Äî</span></div>
          <div class="vital-row"><span class="name">Last decide (ms)</span><span class="value" id="v-last-decide-ms">‚Äî</span></div>
          <div class="vital-row"><span class="name">Last action (ms)</span><span class="value" id="v-last-action-ms">‚Äî</span></div>
          <div class="vital-row"><span class="name">Last tick (ms)</span><span class="value" id="v-last-tick-ms">‚Äî</span></div></div>
        </div>
      </div>
      <div class="hud-actions">
        <button type="button" class="btn-hud" id="btn-think-once" title="Run one think step">Think</button>
        <button type="button" class="btn-hud focus-btn" id="btn-focus" title="Focus mode">Focus</button>
        <button type="button" class="btn-hud" id="btn-continuous" title="Continuous: min 800ms between ticks">Cont.</button>
        <button type="button" class="btn-hud" id="btn-voice" title="Voice (TTS)">Voice</button>
        <button type="button" class="btn-hud" id="btn-pause" title="Pause / Resume">Pause</button>
      </div>
    </header>
    <div id="ollama-banner" class="ollama-banner" role="status" aria-live="polite">
      <span id="ollama-banner-text">Ollama is not running. Start it with: ollama serve</span>
      <button type="button" class="ollama-dismiss" id="ollama-banner-dismiss">Dismiss</button>
    </div>
    <div class="main" id="main-layout">
      <aside class="panel rail" id="rail">
        <div class="panel-head rail-head">
          <div class="rail-main-tabs">
            <button type="button" class="rail-main-tab active" data-rail="mind" aria-selected="true">Mind</button>
            <button type="button" class="rail-main-tab" data-rail="terminal" aria-selected="false">Terminal</button>
          </div>
          <button type="button" class="rail-toggle" id="rail-toggle" title="Collapse panel" aria-label="Collapse panel"><span class="icon">‚óÄ</span></button>
        </div>
        <div class="panel-body">
          <div id="rail-mind" class="rail-pane active">
            <section class="mind-card mind-core" aria-label="Core state">
              <div class="mind-core-bars">
                <div class="mind-core-bar-wrap">
                  <label class="mind-core-bar-label">D</label>
                  <div class="mind-core-bar"><div class="mind-core-fill mind-core-d" id="core-dopamine" style="width:50%"></div></div>
                </div>
                <div class="mind-core-bar-wrap">
                  <label class="mind-core-bar-label">C</label>
                  <div class="mind-core-bar"><div class="mind-core-fill mind-core-c" id="core-cortisol" style="width:20%"></div></div>
                </div>
                <div class="mind-core-bar-wrap">
                  <label class="mind-core-bar-label">S</label>
                  <div class="mind-core-bar"><div class="mind-core-fill mind-core-s" id="core-serotonin" style="width:50%"></div></div>
                </div>
              </div>
              <div class="mind-core-stats"><span class="mind-stat" id="core-neurons">0</span><span class="mind-stat-sep">n</span><span class="mind-stat" id="core-synapses">0</span><span class="mind-stat-sep">syn</span><span class="mind-stat" id="core-thoughts">0</span><span class="mind-stat-sep">th</span></div>
            </section>
            <section class="mind-card now-block" id="now-block" aria-label="Current thought">
              <h3 class="now-head">Now</h3>
              <p class="now-text is-idle" id="current-thought" data-placeholder="Idle">Idle</p>
              <p class="now-reason" id="current-reason" aria-live="polite"></p>
              <span class="now-tag" id="action-tag"></span>
            </section>
            <section class="mind-card goals-block" aria-label="Goals">
              <div class="goals-head">
                <h3 class="goals-title">Goals</h3>
                <span class="goals-count" id="goals-count" aria-live="polite">0 active</span>
              </div>
              <div id="goals-list" class="goals-list"></div>
              <div class="goals-add">
                <input type="text" id="goal-input" placeholder="Add a goal‚Ä¶" maxlength="200" aria-label="New goal" />
                <button type="button" id="goal-add-btn">Add</button>
              </div>
            </section>
            <div class="tabs">
              <button type="button" class="tab active" data-tab="thoughts">Thoughts</button>
              <button type="button" class="tab" data-tab="steps">Steps</button>
            </div>
            <div id="tab-thoughts" class="tab-content active">
              <div id="thoughts-list" class="thoughts-list"></div>
              <div id="thoughts-empty" class="mind-empty" style="display:none;">No thoughts yet</div>
            </div>
            <div id="tab-steps" class="tab-content">
              <div id="steps-list" class="steps-list" aria-live="polite"></div>
              <div id="steps-empty" class="mind-empty" style="display:none;">No steps yet</div>
            </div>
          </div>
          <div id="rail-terminal" class="rail-pane">
            <div class="terminal-panel">
              <div class="terminal-tab-bar">
                <div class="terminal-tabs" id="terminal-tabs"></div>
                <button type="button" class="terminal-tab-add" id="terminal-tab-add" title="New terminal">+</button>
              </div>
              <div class="terminal-content" id="terminal-content">
                <div class="terminal-tab-pane active" data-terminal-id="laura">
            <div class="mind-section-title">Laura‚Äôs terminal (live)</div>
                  <div id="terminal-log" class="terminal-log" aria-live="polite"></div>
                  <div id="terminal-empty" class="empty-state" style="display:none;"><strong>No output yet</strong> Laura's commands appear here.</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </aside>
      <div class="center-space">
        <button type="button" class="rail-toggle-restore" id="rail-toggle-restore" title="Show Mind panel" aria-label="Show Mind panel">Mind ‚ñ∂</button>
        <div class="watermark" aria-hidden="true">LAURA</div>
        <div id="neural-graph" aria-hidden="true"></div>
      </div>
      <div class="chat-wrap">
        <div class="chat-resizer" id="chat-resizer" title="Drag to resize chat" aria-label="Resize chat panel"></div>
        <section class="panel chat-panel">
          <div class="chat-head">
            <div class="title">Chat with Laura</div>
            <div class="sub">Live block below shows what she‚Äôs doing right now. Type to chat; you see her thinking then her reply‚Äîlike Cursor.</div>
          </div>
          <div class="chat-messages" id="chat-messages"></div>
          <div id="chat-live-block" class="chat-live-block" aria-live="polite" title="What she is doing right now‚Äîupdates in real time">
            <div class="chat-live-label">Live</div>
            <div class="chat-live-reason" id="chat-live-reason"></div>
            <div class="chat-live-action" id="chat-live-action"></div>
            <div class="chat-live-thought" id="chat-live-thought">‚Äî</div>
            <div id="live-thought-stream" class="live-thought-stream" aria-live="polite" style="display:none;"></div>
            <div id="stream-action-preview" class="stream-action-preview" style="display:none;" aria-live="polite"></div>
          </div>
          <div class="chat-feedback-row">
            <span class="chat-feedback-label">Feedback (HITL):</span>
            <button type="button" class="btn-feedback" id="feedback-up" title="Positive ‚Äî she did well">üëç</button>
            <button type="button" class="btn-feedback" id="feedback-down" title="Negative ‚Äî adjust behavior">üëé</button>
            <button type="button" class="copy-for-cursor-btn" id="copy-for-cursor" title="Copy Laura's state so you can paste it in Cursor for the AI to fix or debug">Copy for Cursor</button>
          </div>
          <div class="chat-input-row">
            <input type="text" class="chat-input" id="chat-input" placeholder="Plan, @ for context, / for commands" maxlength="2000" title="Type a message. /goal &lt;text&gt; to add a goal, /think to run one step" />
            <button type="button" class="chat-send" id="chat-send">Send</button>
          </div>
        </section>
      </div>
    </div>
  </div>
  <div id="toast" class="toast" role="alert" aria-live="assertive"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="scene.js"></script>
  <script src="renderer.js"></script>
</body>
</html>
